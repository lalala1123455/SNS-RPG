<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SNS‚ÄëRPG ¬´Echoes¬ª ‚Äî Contextual Choices & Profile</title>
  <style>
    body{font-family:system-ui, sans-serif; background:#f6f7f9; margin:0; padding:0;}
    header{background:#4f46e5; color:#fff; padding:12px 20px; display:flex; justify-content:space-between; align-items:center;}
    h1{font-size:20px; margin:0;}
    header button{background:#6366f1; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; font-size:13px;}
    header button:hover{opacity:.9;}

    #app{max-width:600px; margin:0 auto; padding:16px;}
    #stats{background:#fff; border-radius:12px; padding:12px; box-shadow:0 2px 6px rgba(0,0,0,.08); margin-bottom:16px;}
    #feed article{background:#fff; border-radius:12px; padding:12px 14px; margin-bottom:12px; box-shadow:0 1px 4px rgba(0,0,0,.06);}    
    .author{font-weight:600;}
    .msg{margin:6px 0 8px; line-height:1.4;}
    .actions button{border:none; background:none; cursor:pointer; margin-right:8px; font-size:14px;}
    .actions button:hover{opacity:0.8;}
    .like::before{content:"‚ô°"; margin-right:4px;}
    .comment::before{content:"üí¨"; margin-right:4px;}
    .liked{color:#e11d48;}
    #levelUp{background:#fef08a; padding:10px; border-radius:8px; margin-bottom:12px; display:none;}
    #loader{background:#e0e7ff; border-radius:8px; padding:8px 12px; margin-bottom:12px; font-size:14px;}

    .choiceBox{margin-top:8px;}
    .choiceBox button{background:#4f46e5; color:#fff; border:none; border-radius:6px; padding:6px 10px; margin:4px 6px 4px 0; font-size:13px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,.15);}    
    .choiceBox button:hover{opacity:.9;}

    /* Profile modal */
    #profileOverlay{position:fixed; inset:0; background:rgba(0,0,0,.4); display:none; justify-content:center; align-items:center;}
    #profileBox{background:#fff; border-radius:12px; padding:20px 24px; width:90%; max-width:360px; box-shadow:0 4px 12px rgba(0,0,0,.2);}    
    #profileBox h2{margin-top:0; font-size:18px;}
    #profileBox button{background:#ef4444; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer;}
    #profileBox button:hover{opacity:.9;}
  </style>
</head>
<body>
  <header>
    <h1>Echoes ‚Äî SNS‚ÄëRPG</h1>
    <button id="profileBtn">„Éó„É≠„Éï„Ç£„Éº„É´</button>
  </header>

  <div id="app">
    <div id="stats"></div>
    <div id="levelUp"></div>
    <div id="loader">ü§ñ „Éù„Çπ„Éà„ÇíÁîüÊàê‰∏≠‚Ä¶</div>
    <section id="feed"></section>
  </div>

  <!-- Profile Modal -->
  <div id="profileOverlay">
    <div id="profileBox">
      <h2>„ÅÇ„Å™„Åü„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà</h2>
      <p id="pStats"></p>
      <button id="closeProfile">Èñâ„Åò„Çã</button>
    </div>
  </div>

<script>
// ==============================
// Context‚Äëaware Choices & Profile
// ==============================

// 1. Player State
const player = {followers:0, influence:0, level:1, commentsMade:0, likesGiven:0};

// 2. Post Catalogue with Pre‚Äëset Choices
const postCatalogue = [
  // --- Êó¢Â≠ò 7 ‰ª∂ ---
  {text:'‰ªäÊó•„ÅØÈúß„ÅåÊøÉ„ÅÑ„Çè„Å≠„ÄÇÊ£Æ„ÅÆÂ••„Åã„ÇâË™∞„Åã„ÅÆÊ≠åÂ£∞„ÅåËÅû„Åì„Åà„Çã‚Ä¶ ‚ú®', choices:[{text:'üéµ „Åù„ÅÆÊ≠åÂ£∞Ê∞ó„Å´„Å™„ÇãÔºÅ',f:+2,i:+4},{text:'üò± „Å°„Çá„Å£„Å®‰∏çÊ∞óÂë≥‚Ä¶',f:-1,i:+2},{text:'üîç Ë™øÊüª„Å´Ë°å„Åì„ÅÜÔºÅ',f:+3,i:+3}]},
  {text:'ÈÅ∫Ë∑°„ÅßÂè§„ÅÑÁ´ØÊú´„ÇíÊãæ„Å£„ÅüÔºÅ„Åß„ÇÇÈõªÊ∫ê„ÅÆÂÖ•„ÇåÊñπ„ÅåÂàÜ„Åã„Çâ„Å™„ÅÑ„ÄÇ üó∫Ô∏è', choices:[{text:'üí° ÈõªÊ∫ê„Éú„Çø„É≥Êé¢„Åó„Å¶„Åø„Å¶',f:+1,i:+3},{text:'üîß ‰øÆÁêÜÊâã‰ºù„Åä„ÅÜ„ÅãÔºü',f:+3,i:+4},{text:'üóëÔ∏è Êó©„ÅèÊç®„Å¶„ÅüÊñπ„Åå„ÅÑ„ÅÑ„Åã„ÇÇ',f:-2,i:+1}]},
  {text:'„Éâ„É©„Ç¥„É≥„ÅÆÂΩ±„ÇíË¶ã„Åü„Å£„Å¶ÂôÇ„ÄÅ„Åø„Çì„Å™‰ø°„Åò„ÇãÔºü üêâ', choices:[{text:'üî• Êú¨Áâ©„Å†„Å£„Åü„ÇâÂ§ß„Éã„É•„Éº„ÇπÔºÅ',f:+4,i:+4},{text:'ü§î „Ç¨„Çª„Å†„Å®ÊÄù„ÅÜ',f:-1,i:+2},{text:'üõ°Ô∏è ÈÄÄÊ≤ª„Å´Ë°å„Åè„Åπ„ÅçÔºÅ',f:+2,i:+3}]},
  {text:'ÊóÖ‰∫∫„Åï„Çì„ÄÅÊ∏©„Åã„ÅÑ„Çπ„Éº„Éó„ÅØ„ÅÑ„Åã„ÅåÔºü üó∫Ô∏è', choices:[{text:'üç≤ È£≤„Åø„Åü„ÅÑÔºÅ',f:+3,i:+4},{text:'üå°Ô∏è Êú¨ÂΩì„Å´Êöñ„Åã„ÅÑ„ÅÆÔºü',f:+1,i:+2},{text:'üßö „Éî„ÇØ„Ç∑„Åï„ÇìÁîü„Åç„Å¶„Åü„Çì„Å†ÔºÅ',f:+2,i:+3}]},
  {text:'Êòü„ÅåËøë„ÅÑÂ§ú„ÅØ„ÄÅÈ°ò„ÅÑ‰∫ã„ÅåÂè∂„ÅÜ„Çâ„Åó„ÅÑ„ÄÇ üåü', choices:[{text:'üå† ‰Ωï„ÇíÈ°ò„Åä„ÅÜ„Åã„Å™',f:+2,i:+3},{text:'ü§∑‚Äç‚ôÇÔ∏è „Åù„Çì„Å™„ÅÆ‰ø°„Åò„Å™„ÅÑ',f:-1,i:+1},{text:'üìú Âè§„ÅÑ‰ºùÊâø„Åã„ÇÇ„Å≠',f:+1,i:+2}]},
  {text:'„ÇÆ„É´„Éâ„Å´Áèç„Åó„ÅÑ„ÇØ„Ç®„Çπ„Éà„ÅåÊù•„Åü„Çà„ÄÇË≠∑Ë°õ„Å†„Åë„Å©Âç±Èô∫Â∫¶S„É©„É≥„ÇØÔºÅ üè∞', choices:[{text:'üó°Ô∏è ÊåëÊà¶„Åó„Çà„ÅÜÔºÅ',f:+4,i:+4},{text:'üò® ÁÑ°ÁêÜÁÑ°ÁêÜ‚Ä¶',f:-2,i:+1},{text:'üí∞ Â†±ÈÖ¨„ÅØÔºü',f:+2,i:+3}]},
  {text:'Êñ∞„Åó„ÅÑÊ•ΩÂô®„Çí‰Ωú„Å£„Åü„Çì„Å†„ÄÇ‰ªäÂ∫¶ËÅ¥„ÅÑ„Å¶„Åè„Çå„ÇãÔºü üéª', choices:[{text:'üé∂ „Åú„Å≤ËÅ¥„Åç„Åü„ÅÑÔºÅ',f:+3,i:+3},{text:'ü§î Èü≥Á®ãÂêà„Å£„Å¶„ÇãÔºü',f:-1,i:+2},{text:'üëè Áô∫ÊòéÂÆ∂„Å†„Å≠ÔºÅ',f:+2,i:+4}]},

  // --- Êñ∞Ë¶è10‰ª∂ ---
  {text:'Êπñ„Å´Â∑®Â§ß„Å™È≠ö„ÅåÁèæ„Çå„Åü„Çâ„Åó„ÅÑÔºÅË™∞„ÅãË¶ã„ÅüÔºü üêü', choices:[{text:'üé£ Èá£„Çä„Å´Ë°å„Åç„Åü„ÅÑÔºÅ',f:+3,i:+3},{text:'üì∏ ÂÜôÁúü„ÅÇ„ÇãÔºü',f:+2,i:+2},{text:'üòÖ „Åù„Çå„ÅØÁõõ„Çä„Åô„Åé„Åß„ÅØ',f:-1,i:+1}]},
  {text:'È≠îÊ≥ï„ÅÆËä±„ÅåÂí≤„ÅÑ„Åü„Å£„Å¶Ë©±È°å„Å´„Å™„Å£„Å¶„Çã„Çà„ÄÇ üå∏', choices:[{text:'‚ú® Ë¶ã„Å´Ë°å„Åç„Åü„ÅÑÔºÅ',f:+3,i:+4},{text:'ü§î Êú¨ÂΩì„Å´Âí≤„Åè„ÅÆÔºü',f:+1,i:+2},{text:'üò§ „Å©„ÅÜ„Åõ‰Ωú„ÇäË©±',f:-2,i:+1}]},
  {text:'Ë°ó„ÅÆÂ∫ÉÂ†¥„ÅßÂç†„ÅÑÂ∏´„ÅåÁÑ°Êñô„ÅßÊú™Êù•„ÇíË¶ã„Å¶„Åè„Çå„Çã„Å£„Å¶ÔºÅ üîÆ', choices:[{text:'üôã‚Äç‚ôÇÔ∏è Âç†„Å£„Å¶„Åª„Åó„ÅÑÔºÅ',f:+3,i:+3},{text:'ü§∑‚Äç‚ôÄÔ∏è ‰ø°„Åò„Å™„ÅÑ„Å™„ÅÅ',f:-1,i:+2},{text:'üëÄ Ë°åÂàó„Åß„Åç„Å¶„Åü„Çà',f:+2,i:+2}]},
  {text:'‰ªäÊó•„ÅÆÊ£Æ„ÅØÈúß„ÅåÊ∑±„ÅÑ„Åã„ÇâÊ∞ó„Çí„Å§„Åë„Å¶„Å≠„ÄÇ üå´Ô∏è', choices:[{text:'üë£ ËøëÈÅì„Åó„Å¶„Åø„Çã',f:+2,i:+2},{text:'üôÖ‚Äç‚ôÄÔ∏è Ë°å„Åã„Å™„ÅÑÊñπ„Åå„ÅÑ„ÅÑ',f:+1,i:+1},{text:'üò± ÊÄñ„ÅÑ„Åã„Çâ„ÇÑ„ÇÅ„Å®„Åè',f:-1,i:+2}]},
  {text:'Â§©Á©∫Âüé„ÅåË¶ã„Åà„Åü„Å£„Å¶‰∫∫„Åå„ÅÑ„ÇãÔºÅÊú¨ÂΩì„Åã„Å™Ôºü üèØ', choices:[{text:'üëÄ Ë¶ã„Å¶„Åø„Åü„ÅÑÔºÅ',f:+3,i:+4},{text:'ü§® ÂπªË¶ö„Åò„ÇÉÔºü',f:-2,i:+1},{text:'üåà ÂÜíÈô∫„ÅÆ‰∫àÊÑüÔºÅ',f:+2,i:+3}]},
  {text:'Âú∞‰∏ãËø∑ÂÆÆ„Åß„É¨„Ç¢„Ç¢„Ç§„ÉÜ„É†„ÅåË¶ã„Å§„Åã„Å£„Åü„Å£„Å¶ÔºÅ üóùÔ∏è', choices:[{text:'üíé ÂèÇÂä†„Åó„Åü„ÅÑÔºÅ',f:+3,i:+4},{text:'üòÖ Ëø∑Â≠ê„Å´„Å™„Çä„Åù„ÅÜ',f:+1,i:+2},{text:'ü§• Âòò„Åò„ÇÉ„Å™„ÅÑÔºü',f:-2,i:+1}]},
  {text:'ÁÇé„ÅÆÁ•≠„Çä„Åå‰ªäÂ§úÈñãÂÇ¨ÔºÅ„Åø„Çì„Å™Êù•„Å¶„Å≠ÔºÅ üî•', choices:[{text:'üï∫ Áõõ„Çä‰∏ä„Åå„Çä„Åù„ÅÜÔºÅ',f:+3,i:+3},{text:'ü•µ ÁÅ´„ÅÆÁ≤â„Å´Ê≥®ÊÑè',f:+1,i:+2},{text:'üòë „ÅÇ„Åæ„ÇäËààÂë≥„Å™„ÅÑ',f:-1,i:+1}]},
  {text:'Êúà„Åå‰ªäÊó•„ÅØ„ÅÑ„Å§„ÇÇ„Çà„ÇäËµ§„ÅèË¶ã„Åà„Çã‚Ä¶‰∏çÂêâ„Å™‰∫àÊÑüÔºü üåï', choices:[{text:'üåë Á•ûÁßòÁöÑ„Å†„Å≠',f:+2,i:+3},{text:'üò± „Å°„Çá„Å£„Å®ÊÄñ„ÅÑ',f:+1,i:+1},{text:'ü§£ „Åü„Å†„ÅÆÊ∞ó„ÅÆ„Åõ„ÅÑ',f:-1,i:+1}]},
  {text:'Ê∏ØÁî∫„ÅßÊñ∞„Åó„ÅÑÂ∏ÇÂ†¥„Åå„Ç™„Éº„Éó„É≥„Åó„Åü„Çâ„Åó„ÅÑÔºÅ üè™', choices:[{text:'üõçÔ∏è Ë°å„Å£„Å¶„Åø„Åü„ÅÑÔºÅ',f:+3,i:+2},{text:'üç¥ ÁæéÂë≥„Åó„ÅÑ„ÇÇ„ÅÆ„ÅÇ„Çä„Åù„ÅÜ',f:+2,i:+3},{text:'üí∏ ÁØÄÁ¥Ñ‰∏≠„Å†„Åã„ÇâÁÑ°ÁêÜ',f:-1,i:+1}]},
  {text:'Á†ÇÊº†„Åß„Ç™„Ç¢„Ç∑„Çπ„ÇíÁô∫Ë¶ã„Åó„ÅüÊóÖ‰∫∫„Åå„ÅÑ„Çã„Åù„ÅÜÔºÅ üèúÔ∏è', choices:[{text:'üíß Ë°å„Å£„Å¶„Åø„Åü„ÅÑ',f:+3,i:+3},{text:'üß≠ ÈÅì„Å´Ëø∑„ÅÑ„Åù„ÅÜ',f:+1,i:+1},{text:'ü¶¥ Âπª„Å†„Çà„Åü„Å∂„Çì',f:-1,i:+1}]}
];


let postId=0;
const posts=[];

// 3. DOM refs
const statsDiv=document.getElementById('stats');
const feedSec=document.getElementById('feed');
const levelUpDiv=document.getElementById('levelUp');
const loaderDiv=document.getElementById('loader');
const profileBtn=document.getElementById('profileBtn');
const overlay=document.getElementById('profileOverlay');
const pStats=document.getElementById('pStats');
const closeProfile=document.getElementById('closeProfile');

// utility
const rand=arr=>arr[Math.floor(Math.random()*arr.length)];

// Post factory
function createPost(){
  const base=rand(postCatalogue);
  const p=JSON.parse(JSON.stringify(base));
  p.id=++postId; p.likes=0; p.comments=[]; p.liked=false; p.commented=false;
  return p;
}

function renderStats(){
  statsDiv.innerHTML=`<strong>Followers:</strong> ${player.followers} &nbsp; | &nbsp; <strong>Influence:</strong> ${player.influence} &nbsp; | &nbsp; <strong>LV:</strong> ${player.level}`;
}

function checkLevelUp(){
  const need=player.level*20;
  if(player.influence>=need){
    player.level++; player.influence=0;
    levelUpDiv.style.display='block';
    levelUpDiv.textContent=`„É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ LV${player.level}`;
    for(let i=0;i<3;i++) posts.unshift(createPost());
    renderFeed();
    setTimeout(()=>levelUpDiv.style.display='none',4000);
  }
}

function likePost(id){
  const p=posts.find(x=>x.id===id); if(!p||p.liked) return;
  p.likes++; p.liked=true;
  player.followers+=1+Math.floor(player.level/2);
  player.influence+=2;
  player.likesGiven++;
  renderFeed(); renderStats(); checkLevelUp();
}

function commentPost(id){
  const p=posts.find(x=>x.id===id); if(!p||p.commented) return;
  const existing=document.querySelector(`.choiceBox[data-post="${id}"]`);
  if(existing){existing.remove(); return;}
  const art=feedSec.querySelector(`article[data-id="${id}"]`);
  const box=document.createElement('div'); box.className='choiceBox'; box.dataset.post=id;
  p.choices.forEach(ch=>{
    const btn=document.createElement('button'); btn.textContent=ch.text;
    btn.onclick=()=>{applyChoice(p,ch); box.remove();};
    box.appendChild(btn);
  });
  art.appendChild(box);
}

function applyChoice(post,ch){
  post.comments.push(ch.text); post.commented=true;
  player.followers=Math.max(0,player.followers+ch.f);
  player.influence+=ch.i; player.commentsMade++;
  renderFeed(); renderStats(); checkLevelUp();
}

function renderFeed(){
  feedSec.innerHTML='';
  posts.slice(0,20).forEach(p=>{
    const art=document.createElement('article'); art.dataset.id=p.id;
    art.innerHTML=`<div class="author">NPC</div><div class="msg">${p.text}</div><div class="actions"><button class="like ${p.liked?'liked':''}">„ÅÑ„ÅÑ„Å≠ ${p.likes}</button><button class="comment">„Ç≥„É°„É≥„Éà ${p.comments.length}</button></div>`;
    art.querySelector('.like').onclick=()=>likePost(p.id);
    art.querySelector('.comment').onclick=()=>commentPost(p.id);
    feedSec.appendChild(art);
  });
}

// profile modal
function openProfile(){
  pStats.innerHTML=`<strong>Followers:</strong> ${player.followers}<br><strong>Influence:</strong> ${player.influence}<br><strong>Level:</strong> ${player.level}<br><strong>Likes Given:</strong> ${player.likesGiven}<br><strong>Comments Made:</strong> ${player.commentsMade}`;
  overlay.style.display='flex';
}
function closeProfileModal(){overlay.style.display='none';}
profileBtn.onclick=openProfile;
closeProfile.onclick=closeProfileModal;
overlay.onclick=e=>{if(e.target===overlay) closeProfileModal();};

// boot
function boot(){
  for(let i=0;i<5;i++) posts.push(createPost());
  renderStats(); renderFeed(); loaderDiv.style.display='none';
}
window.addEventListener('DOMContentLoaded', boot);
</script>
</body>
</html>
